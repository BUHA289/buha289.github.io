# ì—°ê´€ê´€ê³„ ë§¤í•‘ì´ë€ ?



##  **1. ì—°ê´€ê´€ê³„ ë§¤í•‘ ê°œìš”**

- **ì •ì˜**: JPAì—ì„œ í…Œì´ë¸” ê°„ì˜ ê´€ê³„ë¥¼ ê°ì²´ ì§€í–¥ì ìœ¼ë¡œ í‘œí˜„
- **ì¢…ë¥˜**: `N:1`, `1:N`, `1:1`, `N:M`
- **êµ¬ë¶„**
  - ë‹¨ë°©í–¥: í•œìª½ë§Œ ì°¸ì¡°
  - ì–‘ë°©í–¥: ì–‘ìª½ ëª¨ë‘ ì°¸ì¡°
- **ì£¼ì¸(Owner)**: ì™¸ë˜ í‚¤ë¥¼ ê°€ì§„ ìª½ì´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸

------

##  **1:N ê´€ê³„**

###  ë‹¨ë°©í–¥

- `@OneToMany` + `@JoinColumn` ì‚¬ìš© ì‹œ
- ì™¸ë˜í‚¤ë¥¼ **1ìª½ì—ì„œ ê´€ë¦¬**í•´ì•¼ í•˜ë¯€ë¡œ `UPDATE` SQL ë°œìƒ â†’ ë¹„íš¨ìœ¨ì 
- `@JoinColumn` ì—†ìœ¼ë©´ ì¤‘ê°„ í…Œì´ë¸” ìƒì„±ë¨ â†’ ì„±ëŠ¥ ì €í•˜

||== **ë¹„ì¶”ì²œ** â†’ `N:1` ì–‘ë°©í–¥ì´ ë” ìì—°ìŠ¤ëŸ½ê³  íš¨ìœ¨ì 



### 1 : N ë‹¨ë°©í–¥

<aside> ğŸ“š í•œ ì—”í‹°í‹°ê°€ `@OneToMany`ë¥¼ í†µí•´ ì—¬ëŸ¬ ì—”í‹°í‹°ì™€ ê´€ê³„ë¥¼ ë§ºëŠ” ê²½ìš°ë¥¼ ë§í•œë‹¤. ì´ ê²½ìš° ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ 1ì—ì„œ ê°€ì§€ê³  ìˆë‹¤.

</aside>

![img](https://teamsparta.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2Ffde3a554-e577-4f1c-918b-6fe4aa18deb5%2Fimage.png?table=block&id=717090d6-b252-4d4d-a3b3-da5dab624724&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=580&userId=&cache=v2)

- 1ì˜ Entityê°€ ì™¸ë˜ í‚¤(FK)ë¥¼ ê´€ë¦¬í•œë‹¤. (ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸)
- DB ì…ì¥ì—ì„œëŠ” í•­ìƒ ì™¸ë˜ í‚¤ê°€ N ìª½ì— ìœ„ì¹˜í•´ì•¼ í•œë‹¤. (ì„¤ê³„ìƒ ë¶ˆê°€)
  - 1(Company)ì´ N(Tutor)ì˜ ì™¸ë˜ í‚¤ë¥¼ ìˆ˜ì •í•´ì•¼ í•œë‹¤.

```java
@Entity
@Table(name = "tutor")
public class Tutor {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

    public Tutor() {
    }

    public Tutor(String name) {
        this.name = name;
    }

}
```

```java
@Entity
@Table(name = "company")
public class Company {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

    @OneToMany
    @JoinColumn(name = "company_id")
    private List<Tutor> tutors = new ArrayList<>();

    public Company() {
    }

    public Company(String name) {
        this.name = name;
    }

    public List<Tutor> getTutors() {
        return tutors;
    }
}
```

```java
public class Main {
    public static void main(String[] args) {
        EntityManagerFactory emf = Persistence.createEntityManagerFactory("entity");

        EntityManager em = emf.createEntityManager();

        EntityTransaction transaction = em.getTransaction();

        transaction.begin();

        try {
						// Tutor ìƒì„± ë° persist
            Tutor tutor = new Tutor("wonuk" );
            em.persist(tutor);
						
						// Company ìƒì„± ë° persist
            Company company = new Company("sparta");
            // Tutor í…Œì´ë¸”ì— ì¶”ê°€
            company.getTutors().add(tutor);
            em.persist(company);

            transaction.commit();
        } catch (Exception e) {
            transaction.rollback();
        } finally {
            em.close();
        }

        emf.close();
    }
}
```



- ì‹¤í–‰ê²°ê³¼

  - ê¸°ì¡´ í…Œì´ë¸” ì‚­ì œ í›„ ì‹¤í–‰(ì¶©ëŒ ë°©ì§€)

  - ![img](https://teamsparta.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F6a3afeb4-f878-44dc-93b5-aca9a738164b%2Fimage.png?table=block&id=a01550c9-9c32-45e2-b166-ea9f9c44c5c4&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=580&userId=&cache=v2)

  - ![img](https://teamsparta.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F43ed73b9-1a0d-4976-92c1-032d0b08906f%2Fimage.png?table=block&id=eeeeb6b9-7c73-42e9-9202-058cfb8aaee2&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=580&userId=&cache=v2)

  - ë§ˆì§€ë§‰ì— update SQLì´ ì¶”ê°€ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ì•¼ í•œë‹¤.

    - ì„±ëŠ¥ìƒ ë‹¨ì ì´ ìˆë‹¤.

  - ```
    Company
    ```

     Entityë¥¼ ìˆ˜ì •(add) í–ˆìŒì—ë„ 

    ```
    Tutor
    ```

     í…Œì´ë¸”ì´ ìˆ˜ì •ëœë‹¤.

    - ê°ì²´ì™€ í…Œì´ë¸”ì˜ ì°¨ì´ì ìœ¼ë¡œ ìƒê¸°ëŠ” ì–´ìƒ‰í•œ êµ¬ì¡°ì´ë‹¤.

  - ìœ ì§€ë³´ìˆ˜ì„±ì„ ê³ ë ¤í•˜ì—¬ `N:1` ì–‘ë°©í–¥ìœ¼ë¡œ í’€ì–´ë‚´ë©´ ëœë‹¤.

### ì–‘ë°©í–¥

- `@OneToMany` (1ìª½)
- `@ManyToOne` (Nìª½, ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸)
- Nìª½ì—ì„œ ì™¸ë˜ í‚¤ ê´€ë¦¬ (`insertable=false, updatable=false`ë¡œ ì½ê¸° ì „ìš© ì„¤ì • ê°€ëŠ¥)

------

##  **1:1 ê´€ê³„**

###  ë‹¨ë°©í–¥

- `@OneToOne` ì‚¬ìš©
- ì™¸ë˜í‚¤ë¥¼ ì–´ëŠ í…Œì´ë¸”ì— ë‘ëŠëƒì— ë”°ë¼ ìœ ì—°ì„± ë³€í™”
  - FK ìœ„ì¹˜ = ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸
- `@JoinColumn(unique=true)`ë¡œ ìœ ì¼ì„± ë³´ì¥



### 1 : 1 ë‹¨ë°©í–¥

<aside> ğŸ“š ë‘ Entityê°€ `@OneToOne` ì„ í†µí•´ ì„œë¡œ ê´€ê³„ë¥¼ ë§ºëŠ” ê²½ìš°ë¥¼ ë§í•œë‹¤.

</aside>

- ## 1:1 ì—°ê´€ê´€ê³„ ë‹¨ë°©í–¥

![img](https://teamsparta.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F95b670ee-28d0-4787-b4e9-44163a8819c5%2Fimage.png?table=block&id=36e06a4f-09ec-4f6e-b9a8-e9a3b22b9a93&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=580&userId=&cache=v2)

- ì™¸ë˜ í‚¤(FK)ì˜ ì£¼ì¸ì„ ì„ íƒí•  ìˆ˜ ìˆë‹¤.(`Tutor`ë¡œ ê°€ì •)
- ì™¸ë˜ í‚¤ì— ìœ ë‹ˆí¬ ì œì•½ì¡°ê±´ì´ í•„ìš”í•˜ë‹¤.(`1:1`)

```java
@Entity
@Table(name = "address")
public class Address {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

}
```

```java
@Entity
@Table(name = "tutor")
public class Tutor {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

    @ManyToOne
    @JoinColumn(insertable = false, updatable = false)
    private Company company;

    @OneToOne
    @JoinColumn(name = "address_id", unique = true)
    private Address address;

    public Tutor() {
    }

    public Tutor(String name) {
        this.name = name;
    }
    
    public Long getId() {
        return id;
    }

    public String getName() {
        return name;
    }
}
```

- ì‹¤í–‰ê²°ê³¼

  - ê¸°ì¡´ í…Œì´ë¸” ì‚­ì œ í›„ ì‹¤í–‰(ì¶©ëŒ ë°©ì§€)

    ![img](https://teamsparta.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F62315d12-050d-4508-bd47-e4da93e639d5%2Fimage.png?table=block&id=e417899d-b369-4ab8-84ed-b226a9fba02a&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=480&userId=&cache=v2)

    - **ëŒ€ìƒ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤**

      ![img](https://teamsparta.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F5bcb1b3e-7273-49f5-8147-35affa9360cf%2Fimage.png?table=block&id=9073abfe-317e-48ad-87c3-a1978a262597&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=580&userId=&cache=v2)

      - `Tutor` Entityì˜ `Address`ë¡œ `Address` í…Œì´ë¸”ì˜ `tutor_id`ëŠ” ê´€ë¦¬í•˜ì§€ ëª»í•œë‹¤.
      - ì• ì´ˆì— JPAê°€ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤.

### ì–‘ë°©í–¥

- `@OneToOne(mappedBy = "address")` â†’ ì½ê¸° ì „ìš©
- ì™¸ë˜í‚¤ë¥¼ ê°€ì§„ Entityê°€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸

||== ì™¸ë˜í‚¤ ìœ„ì¹˜:

- ì£¼ í…Œì´ë¸” â†’ ê°ì²´ ì¤‘ì‹¬ ê°œë°œì— ìœ ë¦¬
- ëŒ€ìƒ í…Œì´ë¸” â†’ ë°ì´í„° ë¬´ê²°ì„±ì— ìœ ë¦¬

------

## **N:M ê´€ê³„**

### ë‹¨ë°©í–¥

- `@ManyToMany` ì‚¬ìš© + `@JoinTable`ë¡œ ì¤‘ê°„ í…Œì´ë¸” ì§ì ‘ ëª…ì‹œ
- ì‹¤ë¬´ì—ì„œëŠ” ì˜ ì•ˆ ì”€ â†’ **ì¤‘ê°„ ì—”í‹°í‹°ë¡œ ë¶„ë¦¬í•˜ì—¬ 1:N, N:1ë¡œ êµ¬ì„± ê¶Œì¥**

###  ì–‘ë°©í–¥

- ë°˜ëŒ€í¸ì—ì„œë„ `@ManyToMany(mappedBy = "í•„ë“œëª…")`
- ì¤‘ê°„ í…Œì´ë¸”ì´ ìƒê¸°ë¯€ë¡œ ê´€ë¦¬ ë° ì„±ëŠ¥ ì¸¡ë©´ì—ì„œ ë¶ˆë¦¬

**ì‹¤ë¬´ì—ì„œëŠ” ì¤‘ê°„ í…Œì´ë¸”ì„ Entityë¡œ ë¶„ë¦¬í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì¶”ì²œ**

------

## í•µì‹¬ ìš”ì•½ ë¹„êµ



| ê´€ê³„ ìœ í˜•       | ì¶”ì²œ ë°©ì‹                        | ì£¼ì˜ì‚¬í•­                 |
| --------------- | -------------------------------- | ------------------------ |
| `1:N`           | `N:1` ì–‘ë°©í–¥                     | ì™¸ë˜í‚¤ëŠ” í•­ìƒ Nìª½ì— ìœ„ì¹˜ |
| `1:1`           | ë‹¨ë°©í–¥ or ì–‘ë°©í–¥ (ìš”êµ¬ì‚¬í•­ ë”°ë¼) | FK ìœ„ì¹˜ê°€ ì¤‘ìš”           |
| `N:M`           | ì¤‘ê°„ ì—”í‹°í‹°ë¡œ ë¶„ë¦¬               | ì§ì ‘ ì‚¬ìš©ì€ ë¹„ì¶”ì²œ       |
| ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ | ì™¸ë˜í‚¤ë¥¼ ê°€ì§„ ìª½                 | ë‹¨ë°©í–¥ì´ë©´ ì„¤ì • ë¶ˆí•„ìš”   |